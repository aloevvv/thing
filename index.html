<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Procedural Room Game</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background-color: darkgreen;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #gameArea {
      position: relative;
      width: 600px;
      height: 400px;
      border: 2px solid white;
      overflow: hidden;
    }

    #box {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: white;
    }

    .tree {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: green;
    }

    .rock {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: gray;
    }

    .gold {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: gold;
    }

    .diamond {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: cyan;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <div id="box"></div>
  </div>

  <script>
  const gameArea = document.getElementById("gameArea");
  const box = document.getElementById("box");
  const step = 20;

  let boxX = 280;
  let boxY = 180;
  let roomX = 0;
  let roomY = 0;

  const rooms = {};

  function generateRoom(rx, ry) {
    const key = `${rx},${ry}`;
    if (rooms[key]) return rooms[key]; // Already generated

    const obstacles = [];

    function randomPos() {
      return {
        x: Math.floor(Math.random() * (gameArea.offsetWidth - 40)),
        y: Math.floor(Math.random() * (gameArea.offsetHeight - 40))
      };
    }

    function add(type, count) {
      for (let i = 0; i < count; i++) {
        const pos = randomPos();
        obstacles.push({ type, ...pos });
      }
    }

    add("tree", Math.floor(Math.random() * 3) + 2);
    add("rock", Math.floor(Math.random() * 2) + 1);
    if (Math.random() < 0.25) add("gold", 1);
    if (Math.random() < 0.05) add("diamond", 1);

    rooms[key] = obstacles;
    return obstacles;
  }

  function clearRoom() {
    const children = Array.from(gameArea.children);
    children.forEach(child => {
      if (child !== box) gameArea.removeChild(child);
    });
  }

  function renderRoom(rx, ry) {
    clearRoom();
    const obstacles = generateRoom(rx, ry);
    obstacles.forEach(obs => {
      const div = document.createElement("div");
      div.className = obs.type;
      div.style.left = obs.x + "px";
      div.style.top = obs.y + "px";
      div.style.position = "absolute";
      div.style.width = "40px";
      div.style.height = "40px";
      gameArea.appendChild(div);
    });
  }

  function canMove(newX, newY) {
    const boxRect = {x:newX, y:newY, w:40, h:40};
    const obstacles = rooms[`${roomX},${roomY}`] || [];
    for (const obs of obstacles) {
      if (boxRect.x < obs.x + 40 &&
          boxRect.x + boxRect.w > obs.x &&
          boxRect.y < obs.y + 40 &&
          boxRect.y + boxRect.h > obs.y) {
        return false;
      }
    }
    return true;
  }

  renderRoom(roomX, roomY);
  box.style.left = boxX + "px";
  box.style.top = boxY + "px";

  document.addEventListener("keydown", (event) => {
    let newX = boxX;
    let newY = boxY;

    if (event.key === "ArrowUp") newY -= step;
    if (event.key === "ArrowDown") newY += step;
    if (event.key === "ArrowLeft") newX -= step;
    if (event.key === "ArrowRight") newX += step;

    if (newX < 0) { roomX--; newX = gameArea.offsetWidth - 40; renderRoom(roomX, roomY); }
    else if (newX > gameArea.offsetWidth - 40) { roomX++; newX = 0; renderRoom(roomX, roomY); }
    else if (newY < 0) { roomY--; newY = gameArea.offsetHeight - 40; renderRoom(roomX, roomY); }
    else if (newY > gameArea.offsetHeight - 40) { roomY++; newY = 0; renderRoom(roomX, roomY); }

    if (canMove(newX, newY)) {
      boxX = newX;
      boxY = newY;
      box.style.left = boxX + "px";
      box.style.top = boxY + "px";
    }
  });
</script>
</body>
</html>
